# -*- coding: utf-8 -*-
import scrapy
import time
import json
from zqdk.items import GetTeamBoutExploitsItem
class GetMatchInfoById(scrapy.Spider):
    name = 'getteamboutexploits'
    allowed_domains = ['sport.ttyingqiu.com']
    start_urls = ['http://sport.ttyingqiu.com/']
    def __init__(self):
        self.url='http://sport.ttyingqiu.com/sportdata/f?agentId=2335083&platform=android&appVersion=6.1.0'
    def start_requests(self):
        data={
            "timestamp":str(int(time.time()*1000)),
            "verifyStr":"",
            "simple":"1",
            "apiName":"getMatchListByDate",
            "game":"0",
            "pageNo":"1",
            "pageSize":"300"
        }
        yield scrapy.http.JSONRequest(url=self.url,data=data,callback=self.matchId_requests,method='POST')

    def matchId_requests(self,response):
        result=json.loads(response.text)

        for matchList in result['matchList']:
            data = {"timestamp":str(int(time.time()*1000)),
                    "verifyStr":"",
                    "apiName":"getTeamBoutExploits",
                    "matchId":str(matchList['matchId']),
                    "number":"10"
                    }
            yield scrapy.http.JSONRequest(url=self.url,data=data,callback=self.parse,method='POST')



    def parse(self, response):
        result=json.loads(response.text)
        print(result["list"])
        result=result["list"]
        for matchList in result:

            item=GetTeamBoutExploitsItem()
            item["amidithion"] = matchList.get("amidithion")
            item["asiaHanciap"] = matchList.get("asiaHanciap")
            item["asiaResult"] = matchList.get("asiaResult")
            item["awayName"] = matchList.get("awayName")
            item["awayTeamId"] = matchList.get("awayTeamId")
            item["awayTeamLogo"] = matchList.get("awayTeamLogo")
            item["bigSamllResult"] = matchList.get("bigSamllResult")
            item["bigSmallHanciap"] = matchList.get("bigSmallHanciap")
            item["fullResult"] = matchList.get("fullResult")
            item["halfResult"] = matchList.get("halfResult")
            item["homeName"] = matchList.get("homeName")
            item["homeTeamId"] = matchList.get("homeTeamId")
            item["homeTeamLogo"] = matchList.get("homeTeamLogo")
            item["leagueId"] = matchList.get("leagueId")
            item["leagueName"] = matchList.get("leagueName")
            item["matchId"] = matchList.get("matchId")
            item["matchTime"] = matchList.get("matchTime")
            item["middle"] = matchList.get("middle")
            item["qiutanMatchId"] = matchList.get("qiutanMatchId")

            yield item